{"version":3,"file":"color-scheme.js","sources":["../src/color-scheme.ts"],"sourcesContent":["import { cell } from 'ember-resources';\n\nconst _colorScheme = cell<string | undefined>();\n\nexport const colorScheme = {\n  update: (value: string) => (colorScheme.current = value),\n\n  get current(): string | undefined {\n    return _colorScheme.current;\n  },\n  set current(value: string | undefined) {\n    _colorScheme.current = value;\n\n    if (!value) {\n      localPreference.delete();\n\n      return;\n    }\n\n    localPreference.update(value);\n    setColorScheme(value);\n  },\n};\n\nexport function sync() {\n  /**\n   * If local prefs are set, then we don't care what prefers-color-scheme is\n   */\n  if (localPreference.isSet()) {\n    let pref = localPreference.read();\n\n    if (pref === 'dark') {\n      setColorScheme('dark');\n\n      _colorScheme.current = 'dark';\n\n      return;\n    }\n\n    setColorScheme('light');\n    _colorScheme.current = 'light';\n\n    return;\n  }\n\n  if (prefers.dark()) {\n    setColorScheme('dark');\n    _colorScheme.current = 'dark';\n  } else if (prefers.light()) {\n    setColorScheme('light');\n    _colorScheme.current = 'light';\n  }\n}\n\nexport const prefers = {\n  dark: () => window.matchMedia('(prefers-color-scheme: dark)').matches,\n  light: () => window.matchMedia('(prefers-color-scheme: light)').matches,\n  custom: (name: string) => window.matchMedia(`(prefers-color-scheme: ${name})`).matches,\n  none: () => window.matchMedia('(prefers-color-scheme: no-preference)').matches,\n};\n\nconst LOCAL_PREF_KEY = 'ember-primitives/color-scheme#local-preference';\n\nexport const localPreference = {\n  isSet: () => Boolean(localPreference.read()),\n  read: () => localStorage.getItem(LOCAL_PREF_KEY),\n  update: (value: string) => localStorage.setItem(LOCAL_PREF_KEY, value),\n  delete: () => localStorage.removeItem(LOCAL_PREF_KEY),\n};\n\nexport function getColorScheme(element?: HTMLElement) {\n  let style = styleOf(element);\n\n  return style.getPropertyValue('color-scheme');\n}\n\nexport function setColorScheme(element: HTMLElement, value: string): void;\nexport function setColorScheme(value: string): void;\n\nexport function setColorScheme(...args: [string] | [HTMLElement, string]): void {\n  if (typeof args[0] === 'string') {\n    styleOf().setProperty('color-scheme', args[0]);\n\n    return;\n  }\n\n  if (typeof args[1] === 'string') {\n    styleOf(args[0]).setProperty('color-scheme', args[1]);\n  }\n\n  throw new Error(`Invalid arity, expected up to 2 args, received ${args.length}`);\n}\n\nexport function removeColorScheme(element?: HTMLElement) {\n  let style = styleOf(element);\n\n  style.removeProperty('color-scheme');\n}\n\nfunction styleOf(element?: HTMLElement) {\n  if (element) {\n    return element.style;\n  }\n\n  return document.documentElement.style;\n}\n"],"names":["_colorScheme","cell","colorScheme","update","value","current","localPreference","delete","setColorScheme","sync","isSet","pref","read","prefers","dark","light","window","matchMedia","matches","custom","name","none","LOCAL_PREF_KEY","Boolean","localStorage","getItem","setItem","removeItem","getColorScheme","element","style","styleOf","getPropertyValue","args","setProperty","Error","length","removeColorScheme","removeProperty","document","documentElement"],"mappings":"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"}